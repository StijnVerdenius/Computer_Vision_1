function [imgs, labels] = load_data(set, percentage_to_load, random, from_index, classes, reshaped)
% IMPORTANT: put data in folder stl10_matlab

%input:
% - setname
% - percentage of pictures to load
% - random selection or not (boolean)
% - from index in case not random
% - which classes
% - reshaped (bool) if true then it returns it H x W x Ch x N, if false then it returns it N x (W*H*Ch)


assert (set == "train" || set == "test");
assert (from_index >= 1);
assert (percentage_to_load >= 0 && percentage_to_load <= 1);
    
raw = load("./data/stl10_matlab/"+set+".mat");
trimmed = remove_unwanted_classes(raw, classes);
max = size(trimmed.y, 1);
amount_to_load = floor(percentage_to_load*max-1);

assert(amount_to_load > 0 && amount_to_load <= max);

if (random) 
    indices = randi(max,amount_to_load,1);
else
    to_index = (from_index+amount_to_load);
    assert (to_index <= max);
    indices = from_index:to_index;
end

trimmed.X = trimmed.X(indices, :);
if (reshaped)
    imgs = reshape(transpose(trimmed.X), 96, 96, 3, numel(indices));
else
    imgs = trimmed.X;
end
labels = trimmed.y(indices);

end
